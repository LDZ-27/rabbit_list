<?php
include '../../../config.php';
access_by_cookie($config,$_COOKIE);
$username=$_GET['username'];
$url="https://www.exploit-db.com/search?e_author=$username&draw=1&columns%5B0%5D%5Bdata%5D=date_published&columns%5B0%5D%5Bname%5D=date_published&columns%5B0%5D%5Bsearchable%5D=true&columns%5B0%5D%5Borderable%5D=true&columns%5B0%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B0%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B1%5D%5Bdata%5D=download&columns%5B1%5D%5Bname%5D=download&columns%5B1%5D%5Bsearchable%5D=false&columns%5B1%5D%5Borderable%5D=false&columns%5B1%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B1%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B2%5D%5Bdata%5D=application_md5&columns%5B2%5D%5Bname%5D=application_md5&columns%5B2%5D%5Bsearchable%5D=true&columns%5B2%5D%5Borderable%5D=false&columns%5B2%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B2%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B3%5D%5Bdata%5D=verified&columns%5B3%5D%5Bname%5D=verified&columns%5B3%5D%5Bsearchable%5D=true&columns%5B3%5D%5Borderable%5D=false&columns%5B3%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B3%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B4%5D%5Bdata%5D=description&columns%5B4%5D%5Bname%5D=description&columns%5B4%5D%5Bsearchable%5D=true&columns%5B4%5D%5Borderable%5D=false&columns%5B4%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B4%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B5%5D%5Bdata%5D=type_id&columns%5B5%5D%5Bname%5D=type_id&columns%5B5%5D%5Bsearchable%5D=true&columns%5B5%5D%5Borderable%5D=false&columns%5B5%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B5%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B6%5D%5Bdata%5D=platform_id&columns%5B6%5D%5Bname%5D=platform_id&columns%5B6%5D%5Bsearchable%5D=true&columns%5B6%5D%5Borderable%5D=false&columns%5B6%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B6%5D%5Bsearch%5D%5Bregex%5D=false&columns%5B7%5D%5Bdata%5D=author_id&columns%5B7%5D%5Bname%5D=author_id&columns%5B7%5D%5Bsearchable%5D=false&columns%5B7%5D%5Borderable%5D=false&columns%5B7%5D%5Bsearch%5D%5Bvalue%5D=&columns%5B7%5D%5Bsearch%5D%5Bregex%5D=false&order%5B0%5D%5Bcolumn%5D=0&order%5B0%5D%5Bdir%5D=desc&start=0&length=15&search%5Bvalue%5D=&search%5Bregex%5D=false";
$headers = array();
$headers[]='Host: www.exploit-db.com';
$headers[]='Accept: application/json, text/javascript, */*; q=0.01';
$headers[]='Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2';
$headers[]='Accept-Encoding: identity';
$headers[]='Referer: https://www.exploit-db.com/search';
$headers[]='X-Requested-With: XMLHttpRequest';
$ch = curl_init(); 
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
curl_setopt($ch, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_2_0);
$output = curl_exec($ch);
curl_close ($ch);
echo '[';
if(empty($output))
{
    echo '{}]';
    exit;
}
foreach(json_decode($output) as $item => $data)
{
if($item=='data')
{
foreach($data as $part)
{
    foreach($part as $a => $b)
    {
        if($a=='author_id')
        {
            if(!empty($b[1]))
{
            $author_id='exploit-db_id: '.$b[1];
            echo '{"from_id":"'.$username.'","root_id":"'.$author_id.'","root_label":"'.$author_id.'","type":"username","imageurl":"/img/icon/username.png","title":"Exploit 爬取到的 作者","raw_data":"","edge_color":"yellow","edge_label":"Exploit-db 爬虫"},';      
}
        }
        if($a=='author')
        {
            foreach($b as $id => $content)
            {
                if($id=='name')
                {
                    if(!empty($content))
                    {
                    $author=$content;
                    
                echo '{"from_id":"'.$author_id.'","root_id":"'.$content.'","root_label":"'.$content.'","type":"username","imageurl":"/img/icon/username.png","title":"Exploit 爬取到的 作者","raw_data":"","edge_color":"yellow","edge_label":"Exploit-db 爬虫"},';
                    
            }
                }
            }
        }
        if($a=='code')
        {
            foreach($b as $s)
            {
            foreach($s as $d => $m)
            {
switch($d)
{
    case 'code_type':
        $num=$m;
        break;
    case 'code':
        if(!empty($num))
        {
            $cve=$num.'-'.$m;
            echo '{"from_id":"'.$username.'","root_id":"'.$cve.'","root_label":"'.$cve.'","type":"unknown","imageurl":"/img/icon/unknown.png","title":"Exploit 爬取到的 漏洞证书编号","raw_data":"","edge_color":"yellow","edge_label":"Exploit-db 爬虫"},';
        }

        break;   
}
            }
            }
        }
    }
}
}
}
echo '{}]';
?>